<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Registration - TEAM SOPAN REMIX</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #020212;
            color: #ffffff;
            font-family: 'Plus Jakarta Sans', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, #11113a 0%, #020212 100%);
            overflow-x: hidden;
            padding: 20px;
        }

        .bg-glow {
            position: fixed;
            width: 400px;
            height: 400px;
            background: rgba(99, 102, 241, 0.15);
            filter: blur(100px);
            border-radius: 50%;
            z-index: -1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            border-radius: 24px;
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(to bottom, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #94a3b8;
            font-size: 13px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        #info-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
            padding: 15px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .tab-menu { 
            display: flex; 
            gap: 10px; 
            background: rgba(255, 255, 255, 0.05); 
            padding: 5px; 
            border-radius: 14px; 
            margin-bottom: 25px; 
        }
        .tab-btn { 
            flex: 1; 
            padding: 10px; 
            border: none; 
            border-radius: 10px; 
            font-weight: 700; 
            font-size: 13px; 
            cursor: pointer; 
            background: transparent; 
            color: #94a3b8; 
            transition: 0.3s; 
        }
        .tab-btn.active { 
            background: rgba(255, 255, 255, 0.1); 
            color: #fff; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
        }

        .input-group { margin-bottom: 20px; }
        .input-group label { 
            display: block; 
            font-size: 11px; 
            font-weight: 700; 
            color: #6366f1; 
            margin-bottom: 8px; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .input-group input { 
            width: 100%; 
            padding: 14px 18px; 
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px; 
            color: #fff; 
            font-size: 14px; 
            transition: 0.4s; 
        }
        .input-group input:focus { 
            outline: none;
            border-color: #6366f1; 
            background: rgba(255, 255, 255, 0.05); 
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.1);
        }

        .photo-upload { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-bottom: 25px; }
        .preview-box { 
            width: 90px; 
            height: 90px; 
            border-radius: 50%; 
            background: rgba(255, 255, 255, 0.03); 
            border: 2px dashed rgba(255, 255, 255, 0.2); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden; 
            cursor: pointer; 
            transition: 0.3s;
        }
        .preview-box:hover { border-color: #6366f1; background: rgba(99, 102, 241, 0.05); }
        .preview-box img { width: 100%; height: 100%; object-fit: cover; }
        .preview-box span { font-size: 24px; color: #64748b; }

        .btn-auth { 
            width: 100%; 
            padding: 18px; 
            border: none; 
            border-radius: 16px; 
            background: #ffffff; 
            color: #020212; 
            font-weight: 800; 
            font-size: 14px; 
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer; 
            transition: 0.3s; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .btn-auth:hover { 
            background: #6366f1; 
            color: #fff;
            transform: translateY(-2px); 
        }
        .btn-auth:disabled { opacity: 0.6; cursor: not-allowed; }

        #upload-status { font-size: 11px; font-weight: 700; color: #6366f1; margin-top: 10px; display: none; text-align: center; }
        
        .back-link { 
            display: block; 
            text-align: center; 
            margin-top: 25px; 
            color: #64748b; 
            text-decoration: none; 
            font-size: 13px; 
        }

        /* CUSTOM POPUP STYLES */
        .popup-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 2, 18, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .popup-box {
            background: #0a0a23;
            border: 1px solid #6366f1;
            padding: 30px;
            border-radius: 24px;
            max-width: 380px;
            text-align: center;
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
        }
        .popup-box h2 { font-family: 'Playfair Display', serif; color: #fff; margin-bottom: 15px; }
        .popup-box p { color: #94a3b8; font-size: 14px; margin-bottom: 25px; line-height: 1.6; }
        .popup-btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* NEW INPUT STYLE FOR FILES */
        .file-input-custom {
            padding: 12px; 
            background: rgba(255,255,255,0.02); 
            border: 1px dashed rgba(255,255,255,0.1); 
            border-radius: 12px; 
            font-size: 12px; 
            color: #94a3b8;
            width: 100%;
        }
    </style>
</head>
<body>

    <div class="bg-glow"></div>

    <div class="popup-overlay" id="successPopup">
        <div class="popup-box">
            <h2 id="popupTitle">Berhasil!</h2>
            <p id="popupMessage"></p>
            <button class="popup-btn" onclick="window.location.href='index.html'">Selesai</button>
        </div>
    </div>

    <div class="auth-card" data-aos="fade-up" data-aos-duration="1000">
        <div class="header">
            <p>Join the Circle</p>
            <h1>Sopan Remix</h1>
        </div>

        <div id="info-box">
            ℹ️ Memeriksa status pendaftaran...
        </div>

        <div class="tab-menu">
            <button class="tab-btn active">Form Daftar</button>
            <button class="tab-btn" onclick="alert('Fitur sedang disiapkan!')">Cek Status</button>
        </div>

        <form id="registrationForm">
            <div class="photo-upload">
                <div class="preview-box" onclick="document.getElementById('profilePhoto').click()">
                    <img id="img-preview" src="" style="display:none">
                    <span id="placeholder-icon">+</span>
                </div>
                <label style="font-size: 11px; font-weight: 800; color: #94a3b8; text-align: center;">
                    KLIK UNTUK FOTO PROFIL<br>
                    <span style="color: #6366f1;">(Rasio 1:1)</span>
                </label>
                <input type="file" id="profilePhoto" hidden accept="image/*" required>
                <div id="upload-status">SEDANG MEMPROSES...</div>
            </div>

            <div class="input-group">
                <label>Nama Artis</label>
                <input type="text" id="artistName" placeholder="Contoh: NAMA SOPAN" required>
            </div>

            <div class="input-group">
                <label>WhatsApp</label>
                <input type="tel" id="whatsapp" placeholder="0812xxxx" required>
            </div>

            <div class="input-group">
                <label>Link YouTube</label>
                <input type="url" id="youtube" placeholder="http://youtube.com/..." required>
            </div>

            <div class="input-group">
                <label>Audio Preview (Karya Anda)</label>
                <input type="file" id="audioFile" accept="audio/*" required class="file-input-custom">
            </div>

            <div class="input-group">
                <label>Video Penampilan / Teaser</label>
                <input type="file" id="videoFile" accept="video/*" required class="file-input-custom">
            </div>

            <div class="input-group">
                <label>Bukti Tanggal Project (Screenshot)</label>
                <input type="file" id="proofPhoto" accept="image/*" required class="file-input-custom">
            </div>

            <button type="submit" class="btn-auth" id="submitBtn">Kirim Pendaftaran</button>
        </form>

        <a href="index.html" class="back-link">← Kembali ke Halaman Utama</a>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        const CLOUD_NAME = "dt2u1r8ni"; 
        const UPLOAD_PRESET = "admin_super"; 

        const firebaseConfig = {
            apiKey: "AIzaSyDQJ0dFT8ohAkwDODrdfDa2GEwzk0kZRm0",
            authDomain: "labelmusic-ee1b2.firebaseapp.com",
            projectId: "labelmusic-ee1b2",
            databaseURL: "https://labelmusic-ee1b2-default-rtdb.asia-southeast1.firebasedatabase.app",
            storageBucket: "labelmusic-ee1b2.firebasestorage.app",
            messagingSenderId: "634541524714",
            appId: "1:634541524714:web:a2fc9d47a91e37f44a7993"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        AOS.init();

        function showCustomPopup(id) {
            const popup = document.getElementById('successPopup');
            const msg = document.getElementById('popupMessage');
            msg.innerHTML = `Pendaftaran berhasil dengan ID: <b>${id}</b>.<br><br>Pendaftaran sedang ditinjau admin ya, untuk konfirmasi bisa dicek melalui WhatsApp anda!`;
            popup.style.display = 'flex';
        }

        async function checkDeviceStatus() {
            const savedID = localStorage.getItem('labelMusic_userID');
            const infoBox = document.getElementById('info-box');
            const btn = document.getElementById('submitBtn');

            if (savedID) {
                const snapshot = await database.ref('registrations').orderByChild('userID').equalTo(savedID).once('value');
                
                if (snapshot.exists()) {
                    btn.disabled = true;
                    btn.innerText = "ALREADY REGISTERED";
                    infoBox.innerHTML = "⚠️ Anda sudah terdaftar dengan ID: " + savedID;
                } else {
                    localStorage.removeItem('labelMusic_userID');
                    infoBox.innerHTML = "Silahkah Isi Formulir Dibawah!.";
                    btn.disabled = false;
                }
            } else {
                infoBox.innerHTML = "Pastikan koneksi internet stabil saat mengunggah foto, video, dan audio.";
            }
        }

        checkDeviceStatus();

        document.getElementById('profilePhoto').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('img-preview').src = event.target.result;
                    document.getElementById('img-preview').style.display = 'block';
                    document.getElementById('placeholder-icon').style.display = 'none';
                }
                reader.readAsDataURL(file);
            }
        });

        async function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', UPLOAD_PRESET);

            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {
                method: 'POST',
                body: formData
            });
            if (!res.ok) throw new Error("Gagal upload file!");
            const data = await res.json();
            return data.secure_url;
        }

        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const artistName = document.getElementById('artistName').value;
            
            if (!artistName.endsWith("SOPAN")) {
                alert("Pendaftaran ditolak! Nama Artis wajib diakhiri dengan kata 'SOPAN' (Huruf Besar). Contoh: JONI SOPAN");
                return;
            }

            const btn = document.getElementById('submitBtn');
            const statusLabel = document.getElementById('upload-status');
            
            btn.disabled = true;
            statusLabel.style.display = 'block';

            try {
                const photoFile = document.getElementById('profilePhoto').files[0];
                const audioFile = document.getElementById('audioFile').files[0];
                const videoFile = document.getElementById('videoFile').files[0];
                const proofFile = document.getElementById('proofPhoto').files[0];

                statusLabel.innerText = "SEDANG MENGUPLOAD FOTO PROFIL...";
                const photoUrl = await uploadToCloudinary(photoFile);

                statusLabel.innerText = "SEDANG MENGUPLOAD AUDIO...";
                const audioUrl = await uploadToCloudinary(audioFile);

                statusLabel.innerText = "SEDANG MENGUPLOAD VIDEO...";
                const videoUrl = await uploadToCloudinary(videoFile);

                statusLabel.innerText = "SEDANG MENGUPLOAD BUKTI PROJECT...";
                const proofUrl = await uploadToCloudinary(proofFile);

                statusLabel.innerText = "MENYIMPAN DATA...";
                const generatedID = "SOPAN-" + Math.random().toString(36).substr(2, 6).toUpperCase();

                const finalData = {
                    userID: generatedID,
                    profilePhoto: photoUrl,
                    artistName: artistName,
                    whatsapp: document.getElementById('whatsapp').value,
                    youtube: document.getElementById('youtube').value,
                    audioUrl: audioUrl,
                    videoUrl: videoUrl,
                    projectProofUrl: proofUrl,
                    status: "pending",
                    submittedAt: new Date().toLocaleString()
                };

                await database.ref('registrations').push(finalData);
                localStorage.setItem('labelMusic_userID', generatedID);

                statusLabel.style.display = 'none';
                showCustomPopup(generatedID);

            } catch (err) {
                alert("Kesalahan: " + err.message);
                btn.disabled = false;
                statusLabel.style.display = 'none';
            }
        });
    </script>
</body>
</html>
